<!--banner-->
<div class="banner" [style.background-image]="'url(' + listCatagory[0].urlBanner + ')'">
  <div class="container">
      <div class="row align-items-center">
          <div class="col-sm-7 p-3 text align-self-center">
              <h1>{{ bannerlist?.Name }}</h1>
              <p class="mt-4">
                {{ bannerlist?.introduce }}
              </p>
              <p class="mt-4">
                  {{bannerlist?.relatedProducts}}
              </p>
          </div>
      </div>
  </div>
</div>


<!--header - product-->
<div class="container product my-4">
  <nav class="navbar navbar-expand-lg">
    <div class="container-fluid">
      <span class="navbar-brand d-flex align-items-center" href="#">
        Còn hàng
        <div class="card flex justify-content-center" style="margin-left: 10px;">
          <p-inputSwitch [(ngModel)]="showInStock"></p-inputSwitch>
        </div>      
      </span>
      <button
        style="outline: none;"
        class="navbar-toggler"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#navbarText"
        aria-controls="navbarText"
        aria-expanded="false"
        aria-label="Toggle navigation">
        <span><i class="fa-solid fa-filter"></i> / <i class="fa-solid fa-arrow-up-z-a"></i></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarText">
        <ul class="navbar-nav mx-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <span class="nav-link">
              <div class="dropdown buttons">
                <button
                  type="button"
                  style="color: black"
                  class="btn"
                  data-bs-toggle="dropdown"
                  (click)="toggleList('brands')"
                >
                  <span>Thương hiệu</span>
                  <i
                    id="chevron-icon"
                    class="fa-solid fa-chevron-down mr-2"
                  ></i>
                </button>
              </div>
            </span>
          </li>
          <li class="nav-item">
            <span class="nav-link">
              <div class="dropdown buttons">
                <button
                  type="button"
                  style="color: black"
                  class="btn"
                  data-bs-toggle="dropdown"
                  (click)="toggleList('categories')"
                >
                  <span>Loại sản phẩm</span>
                  <i
                    id="chevron-icon"
                    class="fa-solid fa-chevron-down mr-2"
                  ></i>
                </button>
              </div>
            </span>
          </li>
          <li class="nav-item">
            <span class="nav-link">
              <div class="dropdown buttons">
                <button
                  type="button"
                  style="color: black"
                  class="btn"
                  data-bs-toggle="dropdown"
                  (click)="toggleList('layouts')"
                >
                  <span>Layout</span>
                  <i
                    id="chevron-icon"
                    class="fa-solid fa-chevron-down mr-2"
                  ></i>
                </button>
              </div>
            </span>
          </li>
          <li class="nav-item">
            <span class="nav-link">
              <div class="dropdown buttons">
                <button
                  type="button"
                  style="color: black"
                  class="btn"
                  data-bs-toggle="dropdown"
                  (click)="toggleList('types')"
                >
                  <span>Loại</span>
                  <i
                    id="chevron-icon"
                    class="fa-solid fa-chevron-down mr-2"
                  ></i>
                </button>
              </div>
            </span>
          </li>
          <li class="nav-item">
            <span class="nav-link">
              <div class="dropdown buttons">
                <button
                  type="button"
                  style="color: black"
                  class="btn"
                  data-bs-toggle="dropdown"
                  (click)="toggleList('prices')"
                >
                  <span>Giá</span>
                  <i
                    id="chevron-icon"
                    class="fa-solid fa-chevron-down mr-2"
                  ></i>
                </button>
              </div>
            </span>
          </li>
        </ul>   
        <span class="navbar-text d-flex align-items-center justify-content-end">
          <button>
            <span style="white-space: nowrap"
              >Sắp xếp:
              <h6
                style="
                  display: inline;
                  font-size: 14px;
                  font-weight: 400;
                  position: relative;
                "
              >
                {{ selectedSort }}
              </h6></span
            >
            <div class="btn-group">
              <button
                type="button"
                class="btn"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                <i id="chevron-icon" class="fa-solid fa-chevron-down mr-2"></i>
              </button>
              <ul
                class="dropdown-menu dropdown-menu2 dropdown-menu-end py-3 px-3" 
              >
                <li>
                  <button
                    class="dropdown-item my-1"
                    type="button"
                    (click)="updateSort('Nổi bật')"
                  >
                    <span>Nổi bật</span>
                  </button>
                </li>
                <li>
                  <button
                    class="dropdown-item my-1"
                    type="button"
                    (click)="updateSort('Bán chạy nhất')"
                  >
                    <span>Bán chạy nhất</span>
                  </button>
                </li>
                <li>
                  <button
                    class="dropdown-item my-1"
                    type="button"
                    (click)="updateSort('Thứ tự bảng chữ cái từ (A-Z)')"
                    (click)="sortAlphabetically('asc')"
                  >
                    <span>Thứ tự bảng chữ cái từ (A-Z)</span>
                  </button>
                </li>
                <li>
                  <button
                    class="dropdown-item my-1"
                    type="button"
                    (click)="updateSort('Thứ tự bảng chữ cái từ(Z-A)')"
                    (click)="sortAlphabetically('dsc')"
                  >
                    <span>Thứ tự bảng chữ cái từ(Z-A)</span>
                  </button>
                </li>
                <li>
                  <button
                    class="dropdown-item my-1"
                    type="button"
                    (click)="updateSort('Giá (từ thấp đến cao)')"
                    (click)="sort('dsc')"
                  >
                    <span>Giá (từ cao đến thấp)</span>
                  </button>
                </li>
                <li>
                  <button
                    class="dropdown-item my-1"
                    type="button"
                    (click)="updateSort('Giá (từ thấp đến cao)')"
                    (click)="sort('asc')"
                  >
                    <span>Giá (từ thấp đến cao)</span>
                  </button>
                </li>
                <li>
                  <button
                    class="dropdown-item my-1"
                    type="button"
                    (click)="updateSort('Ngày (từ cũ đến mới)')"
                  >
                    <span>Ngày (từ cũ đến mới)</span>
                  </button>
                </li>
                <li>
                  <button
                    class="dropdown-item my-1"
                    type="button"
                    (click)="updateSort('Ngày (từ mới đến cũ)')"
                  >
                    <span>Ngày (từ mới đến cũ)</span>
                  </button>
                </li>
              </ul>
            </div>
          </button>
        </span>
      </div>
    </div>
  </nav>
</div>

<!-- show ra bộ lọc  -->
<div class="container">
  <div class="brand-list" *ngIf="showBrands || showLayouts || showCategories || showTypes">
    <ul class="dropdown-menu">
      <li 
        class="mx-4"
        *ngFor="let item of getListToShow(currentListName)" 
        (click)="selectItem(item, currentListName)">
        {{ item }} ({{ getCountForItem(item, currentListName) }})
      </li>
    </ul>
  </div>

  <div class="brand-list1" *ngIf="showPrices">
    <ul class="dropdown-menu">
      <li class="mx-4 li-1">
        <div class="card card1 flex justify-content-center">
          <div class="input-container">
            <div class="row">
              <div class="col-3">
                <input 
                  style="width: 100%;" 
                  type="number" 
                  [(ngModel)]="rangeValues[0]" 
                  (input)="updateSliderValues(0); updateInputValues()" 
                  />
              </div>
              <div class="col-6">
                <p-slider 
                  [(ngModel)]="rangeValues" 
                  [range]="true" 
                  [max]="maxValue1" 
                  [min]="minValue1" 
                  class="w-full">
                </p-slider>
              </div>
              <div class="col-3">
                <input 
                  style="width: 100%;" 
                  type="number" 
                  [(ngModel)]="rangeValues[1]" 
                  (input)="updateSliderValues(1); updateInputValues()" 
                  />
              </div>
            </div>  
          </div>
        </div>            
      </li>
    </ul>
  </div>
</div>

<div class="container">
  <div class="row filter-buttons">
    <div class="col-1 button1 mx-2" *ngFor="let filter of selectedFilters" (click)="onClickRemoveQueryParam(filter)">
      {{ filter }}
    </div>
  </div>
</div>


<!-- show sản phẩm -->
<div class="product">
  <div class="container">
    <div class="row align-items-start">
      <div
        class="product-col col-6 col-lg-3 col-md-4 mt-4 mb-4"
        *ngFor="let item of listCatagory | paginate
              : { itemsPerPage: 8, currentPage: page, totalItems: totalLength }"
      >
        <p class="status" *ngIf="item.statusProduct === 'hết hàng'">{{item.statusProduct}}</p>
        <div class="image-container mb-5">
          <img
          [src]="mainImage || (item.options[0].layout[0].optioncolor.length > 0 ? item.options[0].layout[0].optioncolor[0].url : '')"
            alt="{{ item.name }}"
            class="original-image"
            [routerLink]="['product-detail', item.route]"
          />
          <button
            class="btn btn-primary view-more"
            type="button"
            data-bs-toggle="offcanvas"
            data-bs-target="#offcanvasBottom11"
            aria-controls="offcanvasBottom"
            (click)="openCart(item)"
          >
            + Thêm nhanh
          </button>
        </div>
        <div class="d-flex justify-content-between">
          <p class="name-product" href="#">{{ item.name }}</p>
          <div class="star d-flex">5.0<i class="fa fa-star"></i></div>
        </div>
        <p class="price-product mt-1">{{ item.options[0].layout[0].optioncolor[0].optionswitch[0].price }}₫</p>
        <div class="option-img">
          <div class="row text-start">
            <div class="col-md-3 col-4" *ngFor="let color of item.options[0]?.layout[0]?.optioncolor">
              <img
                *ngIf="(item.options[0]?.layout[0]?.optioncolor).length > 1"
                class="img-fluid"
                [ngClass]="{ 'selected': color.url === selectedColor }"
                [src]="color.url"
                alt="{{ item.name }}"
                (click)="changeMainImage(color.url)"
              />
            </div>
          </div>
        </div>    
      </div>
    </div>
    <div class="row text-center mb-5">
      <div class="col">
        <pagination-controls
          class="my-pagination"
          (pageChange)="page = $event"
        ></pagination-controls>
      </div>
    </div>
  </div>
</div>


<!--cart-mua hàng-->
<div
  class="offcanvas offcanvas-bottom model-cart1 ms-auto"
  tabindex="-1"
  id="offcanvasBottom11"
  aria-labelledby="offcanvasBottomLabel"
  [ngClass]="{ show: isCartOpen }"
>
  <div class="offcanvas-body mt-3">
    <div class="offcanvas-headers">
      <div class="body">
        <img [src]="selectedItem?.options[0]?.layout[0]?.optioncolor[0]?.url" alt="{{ selectedItem?.name }}" />
        <div class="name-price">
          <h3>{{ selectedItem?.name }}</h3>
          <p>Giá: {{ selectedPrice || selectedItem?.options[0]?.layout[0]?.optioncolor[0]?.optionswitch[0]?.price }}₫</p>
        </div>
      </div>
      <button
        type="button"
        class="btn-close"
        data-bs-dismiss="offcanvas"
        aria-label="Close"
        (click)="closeCart()"
      ></button>
    </div>

    <div class="row text-center mt-3" *ngIf="(selectedItem?.options[0]?.layout).length < 2">
      <div class="col">
        <p style="font-size: 16px; color: rgb(53, 49, 49); font-weight: 400">
          Layout: {{ selectedLayout || (selectedItem?.options[0]?.layout).length < 2 ?
                     selectedItem?.options[0]?.layout[0].name : ""}}
        </p>
      </div>
    </div>
    <div class="row btn-layout text-center mb-3" *ngIf="(selectedItem?.options[0]?.layout).length < 2">
      <div class="col-2" *ngFor="let layoutItem of selectedItem?.options[0]?.layout">
        <button 
          (click)="selectLayout(layoutItem)" class="btn mt-2"
          [ngStyle]="{ 
                      'border-color': selectedlayoutItem === layoutItem ? '#333' : 'initial',
                      'box-shadow': shouldApplyLayoutBoxShadow(layoutItem) ? '0 0 10px rgba(255, 0, 0, 0.5)' : 'none'
                    }"
            >{{ layoutItem.name }}
        </button>
      </div>
    </div>

    <div class="row text-center mt-3" *ngIf="(selectedItem?.options[0]?.layout[0]?.optioncolor).length > 1">
      <div class="col">
        <p style="font-size: 16px; color: rgb(53, 49, 49); font-weight: 400">
          Color: {{ selectedColor || (selectedItem?.options[0]?.layout[0]?.optioncolor[0]?.name) }}
        </p>
      </div>
    </div>
    <div class="row btn-color text-center mb-3" *ngIf="(selectedItem?.options[0]?.layout[0]?.optioncolor).length > 1">
      <div class="col-4" *ngFor="let colorItem of selectedItem?.options[0]?.layout[0]?.optioncolor">
        <button 
          (click)="selectColor(colorItem)" class="btn mt-2"
          [ngStyle]="{ 
                    'box-shadow': shouldApplyBoxShadow(colorItem) ? '0 0 10px rgba(255, 0, 0, 0.5)' : 'none'
                    }"
            >
            <img [src]="colorItem.url" alt="{{colorItem.name}}" (click)="handleColorItemClick(colorItem)">
        </button>
      </div>
    </div>

    <div class="row text-center mt-3" *ngIf="(selectedItem?.options[0]?.layout[0]?.optioncolor[0]?.optionswitch).length > 0">
      <div class="col">
        <p style="font-size: 16px; color: rgb(53, 49, 49); font-weight: 400">
          Switch: {{ selectedSwitch || (selectedItem?.options[0]?.layout[0]?.optioncolor[0]?.optionswitch[0]?.name)}}
        </p>
      </div>
    </div>
    <div class="row btn-switch text-center mb-3" 
          *ngIf="(selectedItem?.options[0]?.layout[0]?.optioncolor[0]?.optionswitch).length > 0">
      <div class="col-4" 
          *ngFor="let switchItem of selectedSwitches"
      >
        <button 
          (click)="selectSwitch(switchItem)" class="btn mt-2"
          [ngStyle]="{ 
                      'border-color': selectedSwitchItem === switchItem ? '#333' : 'initial',
                      'box-shadow': shouldApplySwitchBoxShadow(switchItem) ? '0 0 10px rgba(255, 0, 0, 0.5)' : 'none'
                    }"
            >{{ switchItem.name }}
        </button>
      </div>
    </div>

    <div class="row buy-cart mt-5">
      <div class="col-12">
        <button class="btn btn-primary" (click)="selectBuy(); isOldCartOpen = false;">Chọn mua</button>
      </div>
    </div>
  </div>
</div>

<div
  class="offcanvas offcanvas-bottom model-cart1 ms-auto"
  tabindex="-1"
  id="offcanvasNewCart"
  aria-labelledby="offcanvasNewCartLabel"
  [ngClass]="{ show: isNewCartOpen }"
  *ngIf="addedCartItem"
>
  <div class="offcanvas-body mt-3">
    <!-- Hiển thị thông báo đã thêm vào giỏ hàng -->
    <div class="row text-center">
      <div class="col" style="color: rgb(103, 185, 21);">
        <p><i class="fa-solid fa-check" style="margin-right: 8px;"></i>Đã thêm vào giỏ hàng</p>
      </div>
      <button
        type="button"
        class="btn-close"
        data-bs-dismiss="offcanvas"
        aria-label="Close"
        (click)="isNewCartOpen = false"
      ></button>
    </div>
    <!-- Hiển thị thông tin sản phẩm đã chọn mua -->
    <div class="offcanvas-headers pb-4 mt-4">
      <div class="body">
        <img [src]="addedCartItem?.imageUrl" alt="" />
        <div class="name-price">
          <h3>{{ addedCartItem?.name }}</h3>
          <p>Giá: ₫{{ addedCartItem?.price }}</p>
          <p>Switch: {{ addedCartItem?.switch }}</p>
        </div>
      </div>
    </div>
    <!-- Nút Xem giỏ hàng -->
    <div class="row buy-cart mt-5 d-flex justify-content-center">
      <div class="col-4">
        <button class="btn btn-primary" routerLink="checkout/cart">Xem giỏ hàng</button>
      </div>
      <div class="col-4">
        <button class="btn btn-primary">Thanh toán</button>
      </div>
    </div>
  </div>
</div>
